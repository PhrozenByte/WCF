WCF.ImageViewer=Class.extend({init:function(){$('<span class="icon icon16 icon-chevron-left jsTooltip" title="'+WCF.Language.get("wcf.imageViewer.previous")+'" />').appendTo($("#lbPrevLink")),$('<span class="icon icon16 icon-chevron-right jsTooltip" title="'+WCF.Language.get("wcf.imageViewer.next")+'" />').appendTo($("#lbNextLink")),$('<span class="icon icon32 icon-remove jsTooltip" title="'+WCF.Language.get("wcf.imageViewer.close")+'" />').appendTo($("#lbCloseLink"));var e=$('<span class="icon icon32 icon-resize-full jsTooltip" title="'+WCF.Language.get("wcf.imageViewer.enlarge")+'" id="lbEnlarge" />').insertAfter($("#lbCloseLink"));e.click($.proxy(this._enlarge,this)),this._initImageViewer(),WCF.DOMNodeInsertedHandler.addCallback("WCF.ImageViewer",$.proxy(this._domNodeInserted,this)),WCF.DOMNodeInsertedHandler.execute()},_domNodeInserted:function(){this._initImageSizeCheck(),this._initImageViewer()},_initImageViewer:function(){var e=$("a.jsImageViewer");e.length&&e.removeClass("jsImageViewer").slimbox({counterText:WCF.Language.get("wcf.imageViewer.counter"),loop:!0})},_enlarge:function(){var e=$("#lbImage").css("backgroundImage");e&&(e=e.replace(/^url\((["']?)(.*)\1\)$/,"$2"),window.location=e)},_initImageSizeCheck:function(){$(".jsResizeImage").on("load",$.proxy(this._checkImageSize,this))},_checkImageSize:function(e){var i=$(e.currentTarget);i.removeClass("jsResizeImage");var n=i.getDimensions(),a=i.parents("div").innerWidth();n.width>a&&(i.css({height:Math.round(n.height*(a/n.width))+"px",width:a+"px"}),i.parents("a").length||(i.wrap('<a href="'+i.attr("src")+'" />'),i.parent().slimbox()))}});